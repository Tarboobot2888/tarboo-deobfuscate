<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TARBOO Deobfuscate - Lite</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
    body { background:#0f0f14; color:#00ff99; font-family:'Share Tech Mono', monospace; margin:0; padding:20px; display:flex; flex-direction:column; align-items:center; }
    h1 { text-shadow:0 0 8px #00ff99; margin-bottom:20px; }
    .container { width:90vw; max-width:900px; }
    textarea { background:#121212; border:1px solid #00ff99; color:#00ff99; width:100%; height:200px; padding:10px; font-family:monospace; font-size:16px; margin-bottom:10px; }
    button { background:#00ff99; border:none; color:#0f0f14; padding:12px 30px; font-size:18px; border-radius:6px; position:relative; }
    button:hover { background:#00cc7a; }
    .spinner { border:3px solid #121212; border-top:3px solid #00ff99; border-radius:50%; width:18px; height:18px; animation:spin 1s linear infinite; position:absolute; left:15px; top:50%; transform:translateY(-50%); display:none; }
    @keyframes spin {100%{transform:rotate(360deg);} }
    .tabs { display:flex; justify-content:center; gap:10px; margin-bottom:10px; }
    .tab { padding:6px 12px; border:1px solid #00ff99; border-radius:6px; cursor:pointer; }
    .tab.active, .tab:hover { background:#00ff99; color:#0f0f14; }
    .output { background:#121212; border:1px solid #00ff99; border-radius:6px; padding:10px; width:100%; min-height:150px; overflow-x:auto; margin-bottom:10px; }
    .copy-btn { float:left; background:#121212; border:1px solid #00ff99; border-radius:4px; padding:4px 8px; cursor:pointer; margin-bottom:6px; }
    .copy-btn:hover { background:#00cc7a; }
  </style>
</head>
<body>
  <h1>TARBOO Deobfuscate - Lite</h1>
  <div class="container">
    <textarea id="inputCode" placeholder="ألصق كود Node.js المشفر هنا..."></textarea>
    <button id="runBtn"><div class="spinner" id="spinner"></div>فك التشفير</button>
    <div class="tabs">
      <div class="tab active" data-tab="base64">Base64</div>
      <div class="tab" data-tab="deobf">فك التمويه</div>
      <div class="tab" data-tab="unmin">تنسيق</div>
      <div class="tab" data-tab="smart">التحليل الذكي</div>
    </div>
    <div id="base64" class="output"><button class="copy-btn" data-target="base64">نسخ</button><pre class="language-js" id="pre-base64"></pre></div>
    <div id="deobf" class="output" style="display:none;"><button class="copy-btn" data-target="deobf">نسخ</button><pre class="language-js" id="pre-deobf"></pre></div>
    <div id="unmin" class="output" style="display:none;"><button class="copy-btn" data-target="unmin">نسخ</button><pre class="language-js" id="pre-unmin"></pre></div>
    <div id="smart" class="output" style="display:none;"><button class="copy-btn" data-target="smart">نسخ JSON</button><pre class="language-json" id="pre-smart"></pre></div>
  </div>
  <script>
    const tabs = document.querySelectorAll('.tab');
    const areas = ['base64','deobf','unmin','smart'];
    tabs.forEach(tab=>tab.onclick=()=>{
      tabs.forEach(t=>t.classList.remove('active'));
      tab.classList.add('active');
      areas.forEach(a=>document.getElementById(a).style.display = a===tab.dataset.tab?'block':'none');
    });
    document.querySelectorAll('.copy-btn').forEach(btn=>{
      btn.onclick=()=>{
        const t=btn.getAttribute('data-target');
        navigator.clipboard.writeText(document.getElementById('pre-'+t).textContent);
      };
    });
    const spinner = document.getElementById('spinner');
    document.getElementById('runBtn').onclick = async ()=>{
      const code = document.getElementById('inputCode').value.trim();
      if(!code) return alert('يرجى إدخال كود!');
      spinner.style.display='block';
      try {
        const res = await fetch('/api/deobfuscate',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({code})});
        const j = await res.json();
        spinner.style.display='none';
        if(j.error) return alert(j.error);
        document.getElementById('pre-base64').textContent = j.base64Decoded;
        document.getElementById('pre-deobf').textContent = j.deobfuscated;
        document.getElementById('pre-unmin').textContent = j.unminified;
        document.getElementById('pre-smart').textContent = JSON.stringify(j.smartAnalysis, null, 2);
        Prism.highlightAll();
        tabs[3].click();
      }catch(e){
        spinner.style.display='none';
        alert('خطأ: '+e.message);
      }
    };
  </script>
</body>
</html>
